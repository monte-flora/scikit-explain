<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accumulate Local Effects (ALE) Documentation &mdash; Scikit-Explain latest documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting ALE, PD, and SHAP on the same plot" href="multiplots.html" />
    <link rel="prev" title="Accumulated Local Effects" href="../ale.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
            <a href="../index.html" class="icon icon-home"> Scikit-Explain
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../explain_toolkit.html">ExplainToolkit</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ale.html">Accumulated Local Effects</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../ale.html#general-use">General Use</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Accumulate Local Effects (ALE) Documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Loading-the-training-data-and-pre-fit-models">Loading the training data and pre-fit models</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Computing-1D-ALE">Computing 1D ALE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Plotting-1D-ALE-for-the-top-features">Plotting 1D ALE for the top features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Modifying-line-colors-and-histogram-color">Modifying line colors and histogram color</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Including-bootstrapping-for-confidence-intervals">Including bootstrapping for confidence intervals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Adding-Individual-Conditional-Expectation-(ICE)-curves">Adding Individual Conditional Expectation (ICE) curves</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Computing-and-Plotting-2D-ALE">Computing and Plotting 2D ALE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Using-ALE-for-interaction-effects">Using ALE for interaction effects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Using-ALE-to-compute-overall-interaction-strength">Using ALE to compute overall interaction strength</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Using-ALE-to-compute-the-main-effect-complexity">Using ALE to compute the main effect complexity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ALE-for-Regression-Problems">ALE for Regression Problems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Computing-Interaction-Strength">Computing Interaction Strength</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ale.html#comparing-methods">Comparing Methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pd.html">Partial Dependence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature_attributions.html">Feature Attributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shap.html">SHAP-Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pimp.html">Permutation Importance</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #343131" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Scikit-Explain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../ale.html">Accumulated Local Effects</a> &raquo;</li>
      <li>Accumulate Local Effects (ALE) Documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/accumulated_local_effect_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Accumulate-Local-Effects-(ALE)-Documentation">
<h1>Accumulate Local Effects (ALE) Documentation<a class="headerlink" href="#Accumulate-Local-Effects-(ALE)-Documentation" title="Permalink to this headline"></a></h1>
<p>This notebook demonstrates how to use <code class="docutils literal notranslate"><span class="pre">skexplain</span></code> to compute 1D or 2D ALE and plot the results. ALE can be used to assess feature importance, feature attributions, and feature interactions. For more information on the dataset and initializing <code class="docutils literal notranslate"><span class="pre">ExplainToolkit</span></code>, see the <a class="reference external" href="https://github.com/monte-flora/mintpy/blob/master/tutorial_notebooks/permutation_importance_tutorial.ipynb">permutatation importance notebook</a>. The concept and calculation of ALE is too much to cover in this notebook. We
highly recommend readers to check out <a class="reference external" href="https://christophm.github.io/interpretable-ml-book/ale.html">Christoph Molnar’s chapter on ALE</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">current_dir</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">skexplain</span>
<span class="kn">import</span> <span class="nn">plotting_config</span>
<span class="kn">import</span> <span class="nn">itertools</span>
</pre></div>
</div>
</div>
<section id="Loading-the-training-data-and-pre-fit-models">
<h2>Loading the training data and pre-fit models<a class="headerlink" href="#Loading-the-training-data-and-pre-fit-models" title="Permalink to this headline"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">estimators</span> <span class="o">=</span> <span class="n">skexplain</span><span class="o">.</span><span class="n">load_models</span><span class="p">()</span>
<span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">skexplain</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="c1"># if any features are categorical, set the type and MintPy will calculate</span>
<span class="c1"># the categorical ALE.</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;urban&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;rural&#39;</span><span class="p">:</span><span class="s1">&#39;category&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Computing-1D-ALE">
<h1>Computing 1D ALE<a class="headerlink" href="#Computing-1D-ALE" title="Permalink to this headline"></a></h1>
<p>The following computes the 1D ALE curves for the features given. The arguments are as follows: * <code class="docutils literal notranslate"><span class="pre">features</span></code>, a single feature or list of features to compute the 1D ALE for. Can also set to <code class="docutils literal notranslate"><span class="pre">'all'</span></code> to compute for all features in the dataframe. * <code class="docutils literal notranslate"><span class="pre">n_bootstrap</span></code>, number of bootstrap iterations to re-compute the 1D ALE to provide confidence intervals * <code class="docutils literal notranslate"><span class="pre">subsample</span></code>, can be a float between 0-1 or an integer, which is interpreted as the percentage of examples or exact number of random samples
to use, respectively. * <code class="docutils literal notranslate"><span class="pre">n_jobs</span></code>, number of processor to run the script on. * <code class="docutils literal notranslate"><span class="pre">n_bins</span></code>, interger, the number of bins to compute the ALE. The bins are not evenly-spaced, but based on percentiles to ensure that a similar number of examples exist in each bin. Recommended to using 20-30 bins. However, highly skewed data may not be divisable into more than 15-20 bins. This issue is handled internally by <code class="docutils literal notranslate"><span class="pre">skexplain</span></code>.</p>
<p>For the ALE calculations, there is an accompanying <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> bar showing the computation progress. Since the computation are relatively quick, we find it best to compute the ALE for all features for three models up front.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explainer</span> <span class="o">=</span> <span class="n">skexplain</span><span class="o">.</span><span class="n">ExplainToolkit</span><span class="p">(</span><span class="n">estimators</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_1d_ds</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">subsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f4a424b51a4e443184244cbc9a210b21", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9b9da0ed6d6c479b89aa3c2d4080ac0b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>The results are stored as an <code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code>. These results can be stored as compressed netcdf files using built-in functions (see load_results in ExplainToolkit).</p>
<section id="Plotting-1D-ALE-for-the-top-features">
<h2>Plotting 1D ALE for the top features<a class="headerlink" href="#Plotting-1D-ALE-for-the-top-features" title="Permalink to this headline"></a></h2>
<p>To limit the scope of our analysis, we can start by plotting the ALE for the most important features. Assuming we have already run the permutation importance, we can pass those into <code class="docutils literal notranslate"><span class="pre">.get_important_vars</span></code>. If we are using multiple models, we can set <code class="docutils literal notranslate"><span class="pre">combine=True</span></code> and this function will make a single list of important predictors (removing duplicates). From this single list, we can ask for only a subset of features (<code class="docutils literal notranslate"><span class="pre">n_vars=7</span></code>). Otherwise, the function will return a dict with the model names
as keys with the top features as items.</p>
<p>To personalize your plots, you can pass a dict <code class="docutils literal notranslate"><span class="pre">display_feature_names</span></code>, which should map the feature names with a prettier, more interpretable name. To see our example of <code class="docutils literal notranslate"><span class="pre">display_feature_names</span></code>, look in <code class="docutils literal notranslate"><span class="pre">plotting_config.py</span></code>. Note that once you develop your own mapping dictionary, it can be used throughout the skexplain plotting suite.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the permutation important results from the saved pickle file</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fnames</span><span class="o">=</span><span class="s1">&#39;multipass_importance_naupdc.nc&#39;</span><span class="p">,)</span>

<span class="c1"># We can use a bulit-in function that will extract the top predictors from all the model</span>
<span class="c1"># remove any duplicate features to produce a single list. In this case, we want the top 7 features</span>
<span class="n">important_vars</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">get_important_vars</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">multipass</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_vars</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Though skexplain will attempt to automate the plotting, users do have some options to correct the plotting or customize it. For example, you can pass the <code class="docutils literal notranslate"><span class="pre">hspace</span></code> or <code class="docutils literal notranslate"><span class="pre">wspace</span></code> arguments to the various plotting scripts with skexplain to customize the space between plots (see <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots_adjust.html">https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots_adjust.html</a> for more information).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">plot_ale</span><span class="p">(</span>
                                   <span class="n">ale</span> <span class="o">=</span> <span class="n">ale_1d_ds</span><span class="p">,</span>
                                   <span class="n">features</span><span class="o">=</span><span class="n">important_vars</span><span class="p">,</span>
                                   <span class="n">display_units</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_units</span><span class="p">,</span>
                                   <span class="n">display_feature_names</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_feature_names</span><span class="p">,</span>
                                  <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_12_0.png" src="../_images/notebooks_accumulated_local_effect_tutorial_12_0.png" />
</div>
</div>
<p>The light blue histogram in the background is the distribution of values the ALE was computed over. In instances where the distribution is poorly sampled, we should have less confident in the ALE value. The ALE value for a particular feature value is interpreted as the expected feature contribution. For example, the generic feature attribution equation is: <span class="math">\begin{equation}
p = \mathbb{E}(f_i) + \sum_i^{N} f_i
\end{equation}</span> where <span class="math notranslate nohighlight">\(p\)</span> is the prediction, <span class="math notranslate nohighlight">\(f_i\)</span> is the contribution from the <span class="math notranslate nohighlight">\(i\)</span>-th feature (of which there are <span class="math notranslate nohighlight">\(N\)</span>), and <span class="math">\mathbb{E}`(f_i) is typical equal to :math:`(1/N)\sum_i^{N} f_i</span>. In panel (e), when the 2-m temperature (<span class="math notranslate nohighlight">\(T_{2m}\)</span>) is below 0<span class="math notranslate nohighlight">\(^{\circ}\)</span>C, the expected contribution is increasingly negative, varying between -6 to -12%, depending on the model. This is a sanity check as one would expect that cooler surface temperatures
to be associated with freezing road surfaces. The large range of expected contributions from both 2-m temperature and surface temperature (panels d and e) also help explain why they were the top-most important features (see the <a class="reference external" href="https://github.com/monte-flora/mintpy/blob/master/tutorial_notebooks/permutation_importance_tutorial.ipynb">permutatation importance notebook</a> ).</p>
</section>
<section id="Modifying-line-colors-and-histogram-color">
<h2>Modifying line colors and histogram color<a class="headerlink" href="#Modifying-line-colors-and-histogram-color" title="Permalink to this headline"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">mintpy</span></code> has default colors, which are designed to be visually-pleasing. However, users are free to give their own colors using the <code class="docutils literal notranslate"><span class="pre">line_colors</span></code> and <code class="docutils literal notranslate"><span class="pre">hist_colors</span></code> argument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">plot_ale</span><span class="p">(</span>
                                   <span class="n">ale</span><span class="o">=</span><span class="n">ale_1d_ds</span><span class="p">,</span>
                                   <span class="n">features</span><span class="o">=</span><span class="n">important_vars</span><span class="p">,</span>
                                   <span class="n">display_units</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_units</span><span class="p">,</span>
                                   <span class="n">display_feature_names</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_feature_names</span><span class="p">,</span>
                                   <span class="n">line_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">],</span>
                                    <span class="n">hist_color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                                  <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_15_0.png" src="../_images/notebooks_accumulated_local_effect_tutorial_15_0.png" />
</div>
</div>
</section>
<section id="Including-bootstrapping-for-confidence-intervals">
<h2>Including bootstrapping for confidence intervals<a class="headerlink" href="#Including-bootstrapping-for-confidence-intervals" title="Permalink to this headline"></a></h2>
<p>A crucial aspect of statistical analysis is providing uncertainty estimates. In skexplain, we use bootstrapping to provide confidence intervals for ALE. The uncertainty in ALE also carries over to other ALE-based statistics (interation strength, main effect complexity, etc.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_1d</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">important_vars</span><span class="p">,</span>
                          <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                          <span class="n">subsample</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                          <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                          <span class="n">n_bins</span><span class="o">=</span><span class="mi">10</span>
                                <span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">plot_ale</span><span class="p">(</span>
                               <span class="n">ale</span><span class="o">=</span><span class="n">ale_1d</span><span class="p">,</span>
                               <span class="n">display_units</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_units</span><span class="p">,</span>
                                <span class="n">display_feature_names</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_feature_names</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "534fae41f4d84254a09d7d58941482ae", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_17_1.png" src="../_images/notebooks_accumulated_local_effect_tutorial_17_1.png" />
</div>
</div>
<p>Note that these confidence intervals are NOT equivalent to the uncertainty in the main effect, which is provided by the ICE curves (see next box). The confidence intervals are simply the uncertainty in the mean value.</p>
</section>
</section>
<section id="Adding-Individual-Conditional-Expectation-(ICE)-curves">
<h1>Adding Individual Conditional Expectation (ICE) curves<a class="headerlink" href="#Adding-Individual-Conditional-Expectation-(ICE)-curves" title="Permalink to this headline"></a></h1>
<p>The ALE curves attempt to estimate the first-order or main effect of a given feature. However, if the ML model is not purely additive and contains feature interactions (e.g., <span class="math notranslate nohighlight">\(\beta x_1x_2\)</span>), then the first-order effects are often higher dimensional. However, the ALE curves is only the expected contribution (the mean value) and will require dimensionality reduction if feature interactions are present. If the reader is unaware of ICE curves, we highly recommend reading the following
chapter: <a class="reference external" href="https://christophm.github.io/interpretable-ml-book/ice.html">https://christophm.github.io/interpretable-ml-book/ice.html</a>.</p>
<p>In this example, we will compute the ICE curves for only the random forest. To compute ICE curves, we call <code class="docutils literal notranslate"><span class="pre">.calc_ice</span></code>. The main argument for the ICE curves is the subsample size. Plotting more than 100-200 curves can make the plot hard to interpret, so we set the size at 200.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ice_ds</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ice</span><span class="p">(</span> <span class="n">features</span><span class="o">=</span><span class="n">important_vars</span><span class="p">,</span>  <span class="n">subsample</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ee9725c4bb5f411ba2020de1ccb0476e", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">plot_ale</span><span class="p">(</span>
                               <span class="n">ale</span><span class="o">=</span><span class="n">ale_1d_ds</span><span class="p">,</span>
                               <span class="n">estimator_names</span> <span class="o">=</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span>
                               <span class="n">display_units</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_units</span><span class="p">,</span>
                               <span class="n">display_feature_names</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_feature_names</span><span class="p">,</span>
                               <span class="n">ice_curves</span><span class="o">=</span><span class="n">ice_ds</span><span class="p">,</span>
                                  <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_21_0.png" src="../_images/notebooks_accumulated_local_effect_tutorial_21_0.png" />
</div>
</div>
<p>ICE curves are a permutation-based method and therefore assume feature dependence. Therefore, when we have dependent features, it can muddle our interpretation. The general idea, however, is that the spread in the ICE curves about the expected contribution indicates feature interactions. Strong feature interactions produce greater variation in the ICE curves.</p>
</section>
<section id="Computing-and-Plotting-2D-ALE">
<h1>Computing and Plotting 2D ALE<a class="headerlink" href="#Computing-and-Plotting-2D-ALE" title="Permalink to this headline"></a></h1>
<p>The previous examples showed the 1D ALE curves. It is also possible to compute the ALE between two features. In this case, we are measuring the additional contribution from the combination of the two features (minus their respective 1D effects). If there is no multiplicative feature interactions between two features in a model, then the 2D ALE is zero everywhere.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;temp2m&#39;</span><span class="p">,</span> <span class="s1">&#39;sfc_temp&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dwpt2m&#39;</span><span class="p">,</span> <span class="s1">&#39;sfc_temp&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;temp2m&#39;</span><span class="p">,</span> <span class="s1">&#39;dwpt2m&#39;</span><span class="p">)]</span>
<span class="n">explainer</span> <span class="o">=</span> <span class="n">skexplain</span><span class="o">.</span><span class="n">ExplainToolkit</span><span class="p">(</span><span class="n">estimators</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,)</span>
<span class="n">ale_2d_ds</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
                                 <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">subsample</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">n_jobs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">estimators</span><span class="p">),</span>
                                 <span class="n">n_bins</span><span class="o">=</span><span class="mi">30</span>
                                <span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">plot_ale</span><span class="p">(</span><span class="n">ale</span><span class="o">=</span><span class="n">ale_2d_ds</span><span class="p">,</span>
                                   <span class="n">display_units</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_units</span><span class="p">,</span>
                                   <span class="n">display_feature_names</span><span class="o">=</span><span class="n">plotting_config</span><span class="o">.</span><span class="n">display_feature_names</span><span class="p">,</span>
                                  <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9a7bb73f54d44db9ac165dd7a6cf2a41", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_24_1.png" src="../_images/notebooks_accumulated_local_effect_tutorial_24_1.png" />
</div>
</div>
<p>In these plots, * The marignal distribution of the two features are shown in each panel * A subsample of the actual data is shown as dots * The kernal density estimate of the dots is overlaid.</p>
<p>The additional overlays can be turned on or off by passing in the appropriate arguments.</p>
</section>
<section id="Using-ALE-for-interaction-effects">
<h1>Using ALE for interaction effects<a class="headerlink" href="#Using-ALE-for-interaction-effects" title="Permalink to this headline"></a></h1>
<p>We can compute the second-order ALE and then use the concept from <a class="reference external" href="https://arxiv.org/abs/1805.04755">Greenwell et al. (2018)</a> (see Section 3.2). In this case we are using the purely second-order ALE rather than the second-order PD. For this example, we will compute the second-ALE for every combination of the most important predictors. We can use same <code class="docutils literal notranslate"><span class="pre">.calc_ale_variance</span></code> call, but set <code class="docutils literal notranslate"><span class="pre">interaction=True</span></code>. We can also use the same <code class="docutils literal notranslate"><span class="pre">.plot_importance</span></code> and in this case set
<code class="docutils literal notranslate"><span class="pre">method='ale_variance_interactions</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_2d_ds</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
                                 <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">subsample</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">n_jobs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                 <span class="n">n_bins</span><span class="o">=</span><span class="mi">30</span>
                                <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "84d136d9c8dd4aadab4e77f8fb3328eb", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_var_2d</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale_variance</span><span class="p">(</span><span class="n">ale</span><span class="o">=</span><span class="n">ale_2d_ds</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">interaction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_var_2d</span><span class="p">[</span><span class="s1">&#39;ale_variance_interactions_rankings__Gradient Boosting&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;ale_variance_interactions_rankings__Gradient Boosting&#x27; (
                                                                           n_vars_ale_variance_interactions: 3)&gt;
array([&#x27;temp2m__sfc_temp&#x27;, &#x27;temp2m__dwpt2m&#x27;, &#x27;dwpt2m__sfc_temp&#x27;],
      dtype=&#x27;&lt;U16&#x27;)
Dimensions without coordinates: n_vars_ale_variance_interactions</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'ale_variance_interactions_rankings__Gradient Boosting'</div><ul class='xr-dim-list'><li><span>n_vars_ale_variance_interactions</span>: 3</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-cb2a73da-9fd8-4b0b-853b-466950c4c302' class='xr-array-in' type='checkbox' checked><label for='section-cb2a73da-9fd8-4b0b-853b-466950c4c302' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>&#x27;temp2m__sfc_temp&#x27; &#x27;temp2m__dwpt2m&#x27; &#x27;dwpt2m__sfc_temp&#x27;</span></div><div class='xr-array-data'><pre>array([&#x27;temp2m__sfc_temp&#x27;, &#x27;temp2m__dwpt2m&#x27;, &#x27;dwpt2m__sfc_temp&#x27;],
      dtype=&#x27;&lt;U16&#x27;)</pre></div></div></li><li class='xr-section-item'><input id='section-e1c2c5da-c18e-43c6-871a-3198b946cd66' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-e1c2c5da-c18e-43c6-871a-3198b946cd66' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-d7660d4d-92af-49a7-bfe8-40210fd9ad09' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d7660d4d-92af-49a7-bfe8-40210fd9ad09' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adict</span> <span class="o">=</span> <span class="n">plotting_config</span><span class="o">.</span><span class="n">display_feature_names</span>
<span class="n">display_feature_names</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">__</span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">adict</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s1"> &amp; </span><span class="si">{</span><span class="n">adict</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="si">}</span><span class="s1">&#39;</span>
                         <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">}</span>

<span class="n">explainer</span><span class="o">.</span><span class="n">plot_importance</span><span class="p">(</span>
                              <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ale_var_2d</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span>
                              <span class="n">panels</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;ale_variance_interactions&#39;</span><span class="p">,</span> <span class="s1">&#39;Logistic Regression&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;ale_variance_interactions&#39;</span><span class="p">,</span> <span class="s1">&#39;Gradient Boosting&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;ale_variance_interactions&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">)</span>
                                     <span class="p">],</span>
                              <span class="n">num_vars_to_plot</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                              <span class="n">display_feature_names</span><span class="o">=</span><span class="n">display_feature_names</span><span class="p">,</span>
                             <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1800x750 with 5 Axes&gt;,
 array([&lt;AxesSubplot:title={&#39;center&#39;:&#39;Logistic Regression&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;Gradient Boosting&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;Random Forest&#39;}&gt;], dtype=object))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_30_1.png" src="../_images/notebooks_accumulated_local_effect_tutorial_30_1.png" />
</div>
</div>
<p>A crucial component of this plot is setting <code class="docutils literal notranslate"><span class="pre">plot_correlated_features=True</span></code>. In this case, features with a linear correlation coefficient &gt; 0.8 are color-coded. We can disregard the ranking of those pairs as the 2D ALE will tend to over-predict the ALE for correlated pairs. Otherwise, we can see an important pairing between number of hours the 2-m temperature is below zero and the current 2-m temperature. Unfortunately, it is not clear whether the Interaction Importance is significantly
different from zero, which muddles our analysis.</p>
</section>
<section id="Using-ALE-to-compute-overall-interaction-strength">
<h1>Using ALE to compute overall interaction strength<a class="headerlink" href="#Using-ALE-to-compute-overall-interaction-strength" title="Permalink to this headline"></a></h1>
<dl class="simple">
<dt>From <a class="reference external" href="https://arxiv.org/abs/1904.03867">Molnar et al. 2019</a>, any high-dimensional prediction function (i.e., an ML model) can be decomposed as a sum of components with increasing dimensionality: :nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{equation}label{eqn:ale_decompose}</dt><dd><p>f(x) = overbrace{f_0}^{text{Intercept}} + overbrace{sum_{j=1}^{P} f_j (x_j)}^{text{1st order effects}} +  overbrace{sum_{j&lt;k}^{P} f_{jk} (x_j,x_k)}^{text{2nd order effects}} + … + overbrace{f_{1,…,P}(x_{1,…,P}}^{text{P-th order effects}}),</p>
</dd>
<dt>end{equation}` Using this concept, we can approximate an ML model as its average model prediction, the first-order ALE, and all second-order or higher effects characterized as the measure of interaction strength (IAS; <a class="reference external" href="https://arxiv.org/abs/1904.03867">Molnar et al. 2019</a>; denoted by <span class="math notranslate nohighlight">\(I(x)\)</span>): :nbsphinx-math:<a href="#id3"><span class="problematic" id="id4">`</span></a>begin{equation}</dt><dd><p>f(x) = frac{1}{N}sum_{i=1}^N f(x^{(i)}) + sum_{j=1}^{P} ALE_j (x_j) + I(x),</p>
</dd>
<dt>end{equation}` We can define the IAS as an approximation error of the first-order ALE with respect to the original model predictions: :nbsphinx-math:<a href="#id5"><span class="problematic" id="id6">`</span></a>begin{equation}</dt><dd><p>IAS = frac{sum_{i=1}^N Big( f[x^{(i)}] - f_{ALE1st}[x^{(i)}]Big)^2}{sum_{i=1}^N Big( f[x^{(i)}] - f_0Big)^2},</p>
</dd>
</dl>
<p>end{equation}` where <span class="math notranslate nohighlight">\(f_{ALE1st} = f_0 + ALE_1(x_1) +...+ALE_P(x_P)\)</span>. If IAS = 0, then a ML model is perfectly approximated by first-order effects and has no predictor interactions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ias</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">interaction_strength</span><span class="p">(</span><span class="n">ale</span><span class="o">=</span><span class="n">ale_1d_ds</span><span class="p">,</span> <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d1c4e68970574a639ce723410faf244a", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ias</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                  (n_bootstrap: 5)
Dimensions without coordinates: n_bootstrap
Data variables:
    Logistic Regression_ias  (n_bootstrap) float64 0.06123 0.06162 ... 0.05994
    Gradient Boosting_ias    (n_bootstrap) float64 0.07487 0.0793 ... 0.07534
    Random Forest_ias        (n_bootstrap) float64 0.1711 0.1725 ... 0.1736
Attributes:
    estimator_output:  probability
    estimators used:   [&#x27;Random Forest&#x27;, &#x27;Gradient Boosting&#x27;, &#x27;Logistic Regre...
    method:            ale_variance
    dimension:         2D
    features used:     [(&#x27;temp2m&#x27;, &#x27;sfc_temp&#x27;), (&#x27;dwpt2m&#x27;, &#x27;sfc_temp&#x27;), (&#x27;tem...
    estimator output:  probability
    interaction:       True
    evaluation_fn:     Interaction Importance</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-de1f4a47-12c8-40ac-b0ae-c85b7288d5c7' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-de1f4a47-12c8-40ac-b0ae-c85b7288d5c7' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span>n_bootstrap</span>: 5</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-68a794a3-4007-4c77-acb2-ed30fa1ba8a4' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-68a794a3-4007-4c77-acb2-ed30fa1ba8a4' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-c46dd369-492e-40aa-8cb4-db3cffdc1d37' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c46dd369-492e-40aa-8cb4-db3cffdc1d37' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>Logistic Regression_ias</span></div><div class='xr-var-dims'>(n_bootstrap)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.06123 0.06162 ... 0.05944 0.05994</div><input id='attrs-32fecdf4-507e-409a-9c2d-39139d07dba5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-32fecdf4-507e-409a-9c2d-39139d07dba5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-571f6c6e-1582-49d5-98b6-8cbec69f06b8' class='xr-var-data-in' type='checkbox'><label for='data-571f6c6e-1582-49d5-98b6-8cbec69f06b8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.06122819, 0.06162117, 0.06119239, 0.0594393 , 0.05994214])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Gradient Boosting_ias</span></div><div class='xr-var-dims'>(n_bootstrap)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.07487 0.0793 ... 0.07578 0.07534</div><input id='attrs-cd4d4fb7-91e4-451a-8c33-fee5f6b7e039' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cd4d4fb7-91e4-451a-8c33-fee5f6b7e039' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a7401c25-cfe3-47c2-a327-76bdefe59bed' class='xr-var-data-in' type='checkbox'><label for='data-a7401c25-cfe3-47c2-a327-76bdefe59bed' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.07486711, 0.07930084, 0.07791905, 0.07578166, 0.07533726])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Random Forest_ias</span></div><div class='xr-var-dims'>(n_bootstrap)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.1711 0.1725 0.1752 0.1667 0.1736</div><input id='attrs-1f0628af-9aa0-4366-b212-5ecf4d65c9c7' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1f0628af-9aa0-4366-b212-5ecf4d65c9c7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b6e922e7-66ac-42e6-bd7b-7c49ea0655c8' class='xr-var-data-in' type='checkbox'><label for='data-b6e922e7-66ac-42e6-bd7b-7c49ea0655c8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.1711143 , 0.17249356, 0.17522642, 0.16670319, 0.17356459])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a95be235-f104-4cee-8e72-32dc05a436e6' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a95be235-f104-4cee-8e72-32dc05a436e6' class='xr-section-summary' >Attributes: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>estimator_output :</span></dt><dd>probability</dd><dt><span>estimators used :</span></dt><dd>[&#x27;Random Forest&#x27;, &#x27;Gradient Boosting&#x27;, &#x27;Logistic Regression&#x27;]</dd><dt><span>method :</span></dt><dd>ale_variance</dd><dt><span>dimension :</span></dt><dd>2D</dd><dt><span>features used :</span></dt><dd>[(&#x27;temp2m&#x27;, &#x27;sfc_temp&#x27;), (&#x27;dwpt2m&#x27;, &#x27;sfc_temp&#x27;), (&#x27;temp2m&#x27;, &#x27;dwpt2m&#x27;)]</dd><dt><span>estimator output :</span></dt><dd>probability</dd><dt><span>interaction :</span></dt><dd>True</dd><dt><span>evaluation_fn :</span></dt><dd>Interaction Importance</dd></dl></div></li></ul></div></div></div>
</div>
<p>The IAS values for all three models are fairly low (the highest value is 0.16 for the random forest). The takeaway is that the overall feature interaction strength is fairly weak for all three models and the models are mainly additive, first-order effects. This is positive result as the model will be more interpretable than had the IAS been much higher.</p>
</section>
<section id="Using-ALE-to-compute-the-main-effect-complexity">
<h1>Using ALE to compute the main effect complexity<a class="headerlink" href="#Using-ALE-to-compute-the-main-effect-complexity" title="Permalink to this headline"></a></h1>
<dl class="simple">
<dt>To describe the shape of the first-order ALE curves, <a class="reference external" href="https://arxiv.org/abs/1904.03867">Molnar et al. 2019</a> introduced the main effect complexity (MEC) statistic: :nbsphinx-math:<a href="#id7"><span class="problematic" id="id8">`</span></a>begin{equation}</dt><dd><p>text{MEC} = frac{1}{sum_{j=1}^P sigma^2_{ALE(x_j)}} sum_{j=1}^{P} sigma^2_{ALE(x_j)} MEC_j</p>
</dd>
</dl>
<p>end{equation}` where <span class="math notranslate nohighlight">\(MEC_j\)</span> is number of line segements needed to approximate the <span class="math notranslate nohighlight">\(ALE(x_j)\)</span> curve with a piece-wise linear function and <span class="math notranslate nohighlight">\(\sigma^2_{ALE(x_j)}\)</span> is the variance of <span class="math notranslate nohighlight">\(ALE(x_j)\)</span>. For a fully linear model, MEC = 1 while higher values indicate more complex first-order effects.</p>
<p>In this example, the logistic regression has “simplier” first-order effects compared to the random forest and gradient-boosted tree.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#mec = explainer.main_effect_complexity(ale=ale_1d_ds)</span>
</pre></div>
</div>
</div>
</section>
<section id="ALE-for-Regression-Problems">
<h1>ALE for Regression Problems<a class="headerlink" href="#ALE-for-Regression-Problems" title="Permalink to this headline"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_california_housing</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">]</span>
<span class="n">model</span><span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RandomForestRegressor()
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explainer</span> <span class="o">=</span> <span class="n">skexplain</span><span class="o">.</span><span class="n">ExplainToolkit</span><span class="p">((</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">),</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">feature_names</span> <span class="o">=</span> <span class="n">feature_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_1d_reg</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span>
                                 <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">subsample</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                 <span class="n">n_jobs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                 <span class="n">n_bins</span><span class="o">=</span><span class="mi">30</span>
                                <span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">plot_ale</span><span class="p">(</span><span class="n">ale_1d_reg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "98e4809cb11f44fab5a45f186ca4bc51", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_42_1.png" src="../_images/notebooks_accumulated_local_effect_tutorial_42_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_var_1d_reg</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale_variance</span><span class="p">(</span><span class="n">ale_1d_reg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ale_var_1d_reg</span><span class="p">[</span><span class="s1">&#39;ale_variance_rankings__Random Forest&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;ale_variance_rankings__Random Forest&#x27; (n_vars_ale_variance: 8)&gt;
array([&#x27;Longitude&#x27;, &#x27;MedInc&#x27;, &#x27;Latitude&#x27;, &#x27;AveOccup&#x27;, &#x27;AveRooms&#x27;,
       &#x27;HouseAge&#x27;, &#x27;AveBedrms&#x27;, &#x27;Population&#x27;], dtype=&#x27;&lt;U10&#x27;)
Dimensions without coordinates: n_vars_ale_variance</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'ale_variance_rankings__Random Forest'</div><ul class='xr-dim-list'><li><span>n_vars_ale_variance</span>: 8</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-a6ab5e23-98ef-44dc-9a1a-ef8a976cace0' class='xr-array-in' type='checkbox' checked><label for='section-a6ab5e23-98ef-44dc-9a1a-ef8a976cace0' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>&#x27;Longitude&#x27; &#x27;MedInc&#x27; &#x27;Latitude&#x27; ... &#x27;AveBedrms&#x27; &#x27;Population&#x27;</span></div><div class='xr-array-data'><pre>array([&#x27;Longitude&#x27;, &#x27;MedInc&#x27;, &#x27;Latitude&#x27;, &#x27;AveOccup&#x27;, &#x27;AveRooms&#x27;,
       &#x27;HouseAge&#x27;, &#x27;AveBedrms&#x27;, &#x27;Population&#x27;], dtype=&#x27;&lt;U10&#x27;)</pre></div></div></li><li class='xr-section-item'><input id='section-b729652a-0602-4c60-ba8b-be4700e6b0d0' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-b729652a-0602-4c60-ba8b-be4700e6b0d0' class='xr-section-summary'  title='Expand/collapse section'>Coordinates: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'></ul></div></li><li class='xr-section-item'><input id='section-c3e9a9c2-76ea-4c3d-bb04-355a2cd58ea9' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c3e9a9c2-76ea-4c3d-bb04-355a2cd58ea9' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explainer</span><span class="o">.</span><span class="n">plot_importance</span><span class="p">(</span>
                          <span class="n">data</span><span class="o">=</span><span class="n">ale_var_1d_reg</span><span class="p">,</span>
                          <span class="n">panels</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;ale_variance&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">)],</span>
                          <span class="n">num_vars_to_plot</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                          <span class="n">plot_correlated_features</span><span class="o">=</span><span class="kc">True</span>
                         <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 900x750 with 3 Axes&gt;, &lt;AxesSubplot:&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_45_1.png" src="../_images/notebooks_accumulated_local_effect_tutorial_45_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;Latitude&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;MedInc&#39;</span><span class="p">)]</span>
<span class="n">ale_2d_ds</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">ale</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
                                 <span class="n">n_bootstrap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">subsample</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                 <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                 <span class="n">n_bins</span><span class="o">=</span><span class="mi">20</span>
                                <span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">plot_ale</span><span class="p">(</span><span class="n">ale_2d_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5730d18854754340b939e855a142fe37", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_accumulated_local_effect_tutorial_46_1.png" src="../_images/notebooks_accumulated_local_effect_tutorial_46_1.png" />
</div>
</div>
<section id="Computing-Interaction-Strength">
<h2>Computing Interaction Strength<a class="headerlink" href="#Computing-Interaction-Strength" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ias</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">interaction_strength</span><span class="p">(</span><span class="n">ale_1d_reg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3b0af168e1ff45808ec567d6fb55a045", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ias</span><span class="p">[</span><span class="s1">&#39;Random Forest_ias&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;xarray.DataArray &#39;Random Forest_ias&#39; ()&gt;
array(0.23275627)
</pre></div></div>
</div>
<p>An IAS=0.23 indicates that there is some decent feature interaction.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ale.html" class="btn btn-neutral float-left" title="Accumulated Local Effects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multiplots.html" class="btn btn-neutral float-right" title="Plotting ALE, PD, and SHAP on the same plot" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Montgomery Flora; Shawn Handler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>